<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Image Compressor â€” Office Tools</title>
  <meta name="description" content="Compress and optimize images in your browser. Set quality, target size (KB), and resize by width/height. Live preview plus perâ€‘image download.">
  <meta name="keywords" content="image compressor, compress jpg, compress png, webp compressor, resize image, online image optimizer">
  <meta name="robots" content="index, follow">
  <style>
    :root{
      --accent:#0b84ff;
      --bg:#ffffff;
      --card:#ffffff;
      --text:#111111;
      --muted:#566173;
      --border:#e5e7eb;
      --shadow:0 8px 24px rgba(10,20,40,.08);
      --menu-bg:#ffffff;
      --success:#22c55e;
    }
    [data-theme="dark"]{
      --bg:#0b0f15;
      --card:#0e141c;
      --text:#f1f5f9;
      --muted:#cbd5e1;
      --border:#1f2a37;
      --shadow:0 18px 40px rgba(0,0,0,.55);
      --menu-bg:#101823;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text);}
    a{color:inherit;text-decoration:none}
    header{position:sticky;top:0;z-index:1000;background:var(--card);box-shadow:var(--shadow)}
    .nav{display:flex;align-items:center;justify-content:space-between;max-width:1200px;margin:0 auto;padding:.7rem 1rem;gap:12px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand-badge{width:36px;height:36px;border-radius:9px;background:var(--accent);display:grid;place-items:center;color:#fff;font-weight:800}
    .brand-name{font-weight:800;font-size:1.05rem}
    .menu{display:flex;gap:10px;align-items:center}
    .menu > li{list-style:none;position:relative}
    .menu > li > a{padding:.55rem .8rem;border-radius:8px;display:flex;align-items:center;gap:6px}
    .menu > li:hover > a{background:rgba(11,132,255,.08)}
    .submenu{display:none;position:absolute;top:calc(100% + 6px);left:0;background:var(--menu-bg);border:1px solid var(--border);border-radius:10px;box-shadow:var(--shadow);min-width:220px;max-height:60vh;overflow:auto}
    .submenu a{display:block;padding:.6rem .9rem;border-bottom:1px solid rgba(0,0,0,.04)}
    .submenu a:last-child{border-bottom:none}
    .menu > li:hover .submenu{display:block}
    .spacer{flex:1}
    .toggle{border:1px solid var(--border);background:transparent;color:var(--text);padding:.45rem .8rem;border-radius:8px;cursor:pointer}
    main{max-width:1200px;margin:1.5rem auto;padding:0 1rem}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow);padding:16px}
    .drop{border:2px dashed var(--border);border-radius:12px;padding:22px;text-align:center;cursor:pointer;transition:.15s;background:transparent}
    .drop.drag{background:rgba(11,132,255,.07)}
    .controls{display:flex;flex-wrap:wrap;gap:12px;margin:14px 0}
    .control{flex:1;min-width:170px}
    label{display:block;font-size:.9rem;color:var(--muted);margin-bottom:6px}
    input,select{width:100%;padding:.55rem;border:1px solid var(--border);border-radius:8px;background:var(--bg);color:var(--text)}
    .primary{background:var(--accent);color:#fff;border:none;border-radius:8px;padding:.6rem 1rem;cursor:pointer}
    .results{display:flex;flex-direction:column;gap:18px;margin-top:16px}
    .pair{display:flex;gap:22px;flex-wrap:wrap}
    .col{flex:1;min-width:260px}
    .col img{max-width:100%;border-radius:10px;box-shadow:var(--shadow)}
    .meta{font-size:.85rem;color:var(--muted);margin-top:6px}
    .download{display:none;margin-top:8px;background:var(--success);color:#fff;padding:.45rem .8rem;border-radius:8px}
    .progress{width:28px;height:28px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite;margin:8px auto;display:none}
    @keyframes spin{to{transform:rotate(360deg)}}
    footer{padding:20px;text-align:center;color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end}
  </style>
</head>
<body>
  <header>
    <nav class="nav">
      <div class="brand">
        <div class="brand-badge">OT</div>
        <div class="brand-name">Office Tools</div>
      </div>
      <ul class="menu">
        <li>
          <a href="index.html">Home</a>
        </li>
        <li>
          <a href="#">PDF Tools â–¾</a>
          <div class="submenu">
            <a href="pdf-compressor.html">PDF Compressor</a>
            <a href="#">PDF Editor</a>
            <a href="#">PDF to Image</a>
            <a href="#">PDF to Word</a>
            <a href="#">PDF to Excel</a>
          </div>
        </li>
        <li>
          <a href="#">Excel Tools â–¾</a>
          <div class="submenu">
            <a href="#">Excel to PDF</a>
            <a href="xls-to-xlsx.html">XLS to XLSX</a>
          </div>
        </li>
        <li>
          <a href="#">Image Tools â–¾</a>
          <div class="submenu">
            <a href="img-compress.html">Image Compressor</a>
            <a href="#">Image to PDF</a>
            <a href="#">Image Editor</a>
          </div>
        </li>
      </ul>
      <div class="spacer"></div>
      <button id="modeToggle" class="toggle" type="button">ðŸŒ™ Dark</button>
    </nav>
  </header>

  <main>
    <div class="card">
      <h1 style="margin:0 0 8px 0">Image Compressor</h1>
      <p class="muted">Drag & drop or browse images. Adjust quality, target file size, or resize by width/height. Live preview before download.</p>

      <div id="drop" class="drop" tabindex="0" aria-label="Drop images here or click to browse">
        <strong>Drop images here</strong>
        <div style="margin-top:6px">or <button id="browseBtn" class="primary" type="button">Browse</button></div>
        <input id="fileInput" type="file" accept="image/*" multiple hidden>
      </div>

      <div class="controls">
        <div class="control">
          <label for="quality">Quality: <span id="qVal">85</span>%</label>
          <input id="quality" type="range" min="10" max="100" value="85">
        </div>
        <div class="control">
          <label for="targetKB">Target size (KB, 0=ignore)</label>
          <input id="targetKB" type="number" value="0" min="0" step="1">
        </div>
        <div class="control">
          <label for="maxW">Max width (px, 0=keep)</label>
          <input id="maxW" type="number" value="0" min="0" step="1">
        </div>
        <div class="control">
          <label for="maxH">Max height (px, 0=keep)</label>
          <input id="maxH" type="number" value="0" min="0" step="1">
        </div>
        <div class="row">
          <button id="previewBtn" class="primary" type="button">Preview</button>
          <button id="compressBtn" class="primary" type="button">Compress</button>
        </div>
      </div>

      <div id="results" class="results" aria-live="polite"></div>
    </div>
  </main>

  <footer>Â© <span id="year"></span> Office Tools</footer>

  <script>
    // ------- Theme boot + toggle -------
    (function(){
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const saved = localStorage.getItem('theme');
      const initial = saved || (prefersDark ? 'dark' : 'light');
      const root = document.documentElement;
      const btn = document.getElementById('modeToggle');
      function apply(theme){
        root.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        btn.textContent = theme === 'dark' ? 'â˜€ï¸ Light' : 'ðŸŒ™ Dark';
      }
      apply(initial);
      btn.addEventListener('click', () => {
        const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        apply(next);
      });
      document.getElementById('year').textContent = new Date().getFullYear();
    })();

    // ------- Elements -------
    const drop = document.getElementById('drop');
    const fileInput = document.getElementById('fileInput');
    const browseBtn = document.getElementById('browseBtn');
    const quality = document.getElementById('quality');
    const qVal = document.getElementById('qVal');
    const targetKB = document.getElementById('targetKB');
    const maxW = document.getElementById('maxW');
    const maxH = document.getElementById('maxH');
    const results = document.getElementById('results');
    const previewBtn = document.getElementById('previewBtn');
    const compressBtn = document.getElementById('compressBtn');

    qVal.textContent = quality.value;
    quality.addEventListener('input', () => qVal.textContent = quality.value);

    // ------- Drag & Drop + Browse (robust) -------
    function highlight(on){ drop.classList.toggle('drag', !!on); }
    ;['dragenter','dragover'].forEach(ev=>drop.addEventListener(ev, e=>{e.preventDefault();e.stopPropagation();highlight(true);}));
    ;['dragleave','drop'].forEach(ev=>drop.addEventListener(ev, e=>{e.preventDefault();e.stopPropagation();highlight(false);}));

    drop.addEventListener('drop', e => {
      const dt = e.dataTransfer;
      const files = dt.files && dt.files.length ? dt.files : Array.from(dt.items||[]).filter(i=>i.kind==='file').map(i=>i.getAsFile());
      if(!files || !files.length) return;
      handleFiles(files);
    });

   document.getElementById('browseBtn').addEventListener('click', () => {
  fileInput.value = "";   // reset so same file can be chosen again
  fileInput.click();
});
    browseBtn.addEventListener('click', () => fileInput.click());
    drop.addEventListener('keydown', e => { if(e.key==='Enter' || e.key===' ') fileInput.click(); });

    fileInput.addEventListener('change', e => {
      if(!e.target.files || !e.target.files.length) return;
      handleFiles(e.target.files);
      // reset input so re-choosing the same file triggers change again
      fileInput.value = '';
    });

    // ------- State -------
    let items = []; // {file, img, cimg, cmeta, dl, prog}

    function handleFiles(list){
      items = [];
      results.innerHTML = '';
      const arr = Array.from(list).filter(f => f && f.type && f.type.startsWith('image/'));
      if(!arr.length){ alert('No image files detected.'); return; }

      arr.forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = new Image();
          img.onload = () => {
            // Build UI pair
            const wrap = document.createElement('div'); wrap.className = 'pair';
            const colL = document.createElement('div'); colL.className = 'col';
            const colR = document.createElement('div'); colR.className = 'col';

            const oTitle = document.createElement('h3'); oTitle.textContent = 'Original';
            const oImg = document.createElement('img'); oImg.src = e.target.result; oImg.alt = file.name;
            const oMeta = document.createElement('div'); oMeta.className='meta';
            oMeta.textContent = `${file.name} â€” ${(file.size/1024).toFixed(1)} KB â€” ${img.width}Ã—${img.height}`;

            const cTitle = document.createElement('h3'); cTitle.textContent = 'Compressed';
            const cImg = document.createElement('img'); cImg.alt = 'preview';
            const cMeta = document.createElement('div'); cMeta.className='meta'; cMeta.textContent = 'Adjust settings to previewâ€¦';
            const prog = document.createElement('div'); prog.className='progress';
            const dl = document.createElement('a'); dl.className='download'; dl.textContent='Download';

            colL.append(oTitle, oImg, oMeta);
            colR.append(cTitle, cImg, cMeta, prog, dl);
            wrap.append(colL, colR);
            results.appendChild(wrap);

            items.push({file, img, cimg:cImg, cmeta:cMeta, dl, prog});
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      });
    }

    // ------- Compression Core (with size targeting via binary search) -------
    async function compressImage(file, img, maxWidth, maxHeight, qualityPct, targetKB){
      // Compute target dimensions
      let w = img.naturalWidth || img.width, h = img.naturalHeight || img.height;
      if(maxWidth>0 && w > maxWidth){ h = Math.round(h * (maxWidth / w)); w = maxWidth; }
      if(maxHeight>0 && h > maxHeight){ w = Math.round(w * (maxHeight / h)); h = maxHeight; }

      const canvas = document.createElement('canvas');
      canvas.width = w; canvas.height = h;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, w, h);

      function toBlob(q){ return new Promise(resolve => canvas.toBlob(b => resolve(b), 'image/jpeg', q)); }

      let blob;
      if(targetKB > 0){
        // binary search to approximate the targetKB
        let low = 0.05, high = 1.0, best = null;
        for(let i=0; i<14; i++){
          const mid = (low + high) / 2;
          const b = await toBlob(mid);
          if(!b){ continue; }
          const kb = b.size / 1024;
          best = b;
          if(kb > targetKB){ // too big -> reduce quality
            high = mid;
          } else { // too small -> increase a bit
            low = mid;
          }
        }
        blob = best;
      } else {
        blob = await toBlob(Math.max(0.05, Math.min(1, qualityPct / 100)));
      }

      if(!blob) throw new Error('Compression failed');
      return { blob, width: w, height: h };
    }

    async function updatePreview(oneItem){
      if(!oneItem) return;
      oneItem.prog.style.display = 'block';
      try{
        const {blob, width, height} = await compressImage(
          oneItem.file, oneItem.img,
          parseInt(maxW.value||'0',10),
          parseInt(maxH.value||'0',10),
          parseInt(quality.value||'85',10),
          parseInt(targetKB.value||'0',10)
        );
        const url = URL.createObjectURL(blob);
        oneItem.cimg.src = url;
        oneItem.cmeta.textContent = `(Preview) ~${(blob.size/1024).toFixed(1)} KB â€” ${width}Ã—${height}`;
        // do not show download in preview
      } catch(err){
        oneItem.cmeta.textContent = 'Preview failed';
        console.error(err);
      } finally{
        oneItem.prog.style.display = 'none';
      }
    }

    // Live preview on change (affects first item to keep UI fast)
    ;[quality, targetKB, maxW, maxH].forEach(el => el.addEventListener('input', () => items[0] && updatePreview(items[0])));
    previewBtn.addEventListener('click', () => items[0] && updatePreview(items[0]));

    // Full compress for all items
    compressBtn.addEventListener('click', async () => {
      if(!items.length){ alert('Please add images first.'); return; }
      for(const it of items){
        it.prog.style.display = 'block';
        try{
          const {blob, width, height} = await compressImage(
            it.file, it.img,
            parseInt(maxW.value||'0',10),
            parseInt(maxH.value||'0',10),
            parseInt(quality.value||'85',10),
            parseInt(targetKB.value||'0',10)
          );
          const url = URL.createObjectURL(blob);
          it.cimg.src = url;
          it.cmeta.textContent = `${(blob.size/1024).toFixed(1)} KB â€” ${width}Ã—${height}`;
          it.dl.href = url;
          it.dl.download = 'compressed-' + it.file.name.replace(/\.(jpe?g|png|webp|gif|bmp|tiff)$/i, '') + '.jpg';
          it.dl.style.display = 'inline-block';
        } catch(err){
          it.cmeta.textContent = 'Compression failed';
          console.error(err);
        } finally {
          it.prog.style.display = 'none';
        }
      }
    });

    // Clipboard paste support
    window.addEventListener('paste', e => {
      const items = Array.from((e.clipboardData && e.clipboardData.items) || [])
        .filter(i => i.kind === 'file' && i.type.startsWith('image/'))
        .map(i => i.getAsFile());
      if(items.length) handleFiles(items);
    });

    // Basic feature detection
    if(!window.FileReader || !document.createElement('canvas').toBlob){
      alert('Your browser may not fully support client-side compression. Use the latest Chrome, Edge, or Firefox.');
    }
  </script>
</body>
</html>
